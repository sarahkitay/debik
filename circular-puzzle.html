<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Circular Puzzle</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root { --font-display: "Cormorant Garamond", Georgia, serif; --font-body: "DM Sans", sans-serif; --cream: #f3efe7; --puzzle-green: #6b7d5e; }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:var(--font-body); background:var(--cream); min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:40px 20px; }
  .lbl { font-size:.7rem; font-weight:600; letter-spacing:3.5px; text-transform:uppercase; color:#7a9b8e; margin-bottom:28px; text-align:center; }
  .wrap { position:relative; width:520px; height:520px; }
  .pc { position:absolute; left:0; top:0; width:520px; height:520px; cursor:grab; user-select:none; touch-action:none; will-change:transform; z-index:1; transform:translate(var(--px,0px),var(--py,0px)); transition:filter .2s ease; }
  .pc svg { width:100%; height:100%; display:block; }
  .pc:hover:not(.dr):not(.dn) { filter:drop-shadow(0 8px 20px rgba(0,0,0,.15)); }
  .pc.dr { cursor:grabbing; z-index:10!important; filter:drop-shadow(0 16px 32px rgba(0,0,0,.22)); }
  .pc.dn { cursor:default; z-index:2; transition:transform .4s cubic-bezier(.25,.46,.45,.94), filter .25s; filter:drop-shadow(0 2px 6px rgba(0,0,0,.06)); }
  .pc.nr { filter:drop-shadow(0 10px 24px rgba(156,198,172,.4)); }
  .tx { font-family:var(--font-body); color:#fff; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:8px; height:100%; transition:opacity .9s ease .3s; }
  .tx .n { font-family:var(--font-display); font-size:13px; letter-spacing:.12em; opacity:.6; margin-bottom:3px; }
  .tx h3 { font-size:14px; font-weight:600; line-height:1.3; margin-bottom:5px; }
  .tx p { font-size:11.5px; line-height:1.45; opacity:.85; }
  .ad .tx { opacity:0; }
  .sf { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); z-index:20; font-family:var(--font-display); font-style:italic; font-size:1.6rem; letter-spacing:.04em; color:rgba(255,255,255,.95); white-space:nowrap; opacity:0; pointer-events:none; transition:opacity 1s ease .4s; }
  .ad .sf { opacity:1; animation:sg 3s ease-in-out 1.5s infinite; }
  @keyframes sg { 0%,100%{text-shadow:0 0 16px rgba(156,198,172,.4),0 0 36px rgba(156,198,172,.15)} 50%{text-shadow:0 0 26px rgba(180,220,196,.7),0 0 60px rgba(180,220,196,.3)} }
  .ht { position:absolute; bottom:-36px; left:50%; transform:translateX(-50%); font-size:.7rem; letter-spacing:2.5px; text-transform:uppercase; color:rgba(74,74,74,.35); transition:opacity .5s; }
  .ad .ht { opacity:0; }
  .rg { position:absolute; left:0; top:0; width:520px; height:520px; border-radius:50%; background:var(--puzzle-green); box-shadow:0 8px 40px rgba(0,0,0,.1),0 2px 10px rgba(0,0,0,.05); opacity:0; pointer-events:none; transition:opacity .6s ease .3s; z-index:0; }
  .ad .rg { opacity:1; }
</style>
</head>
<body>
<div class="lbl">This work might resonate if...</div>
<div class="wrap" id="W">
  <div class="rg"></div>
  <div class="pc" id="p0"><svg viewBox="0 0 520 520"><path id="s0" fill="#7a8d6d"/></svg></div>
  <div class="pc" id="p1"><svg viewBox="0 0 520 520"><path id="s1" fill="#6b7d5e"/></svg></div>
  <div class="pc" id="p2"><svg viewBox="0 0 520 520"><path id="s2" fill="#8a9a7b"/></svg></div>
  <div id="x0" class="pc" style="pointer-events:none;z-index:3"><svg viewBox="0 0 520 520"><foreignObject x="140" y="25" width="240" height="200"><div class="tx" xmlns="http://www.w3.org/1999/xhtml"><span class="n">01</span><h3>When the old story no longer fits</h3><p>You don't feel like yourself lately, and the way you understand yourself no longer fits.</p></div></foreignObject></svg></div>
  <div id="x1" class="pc" style="pointer-events:none;z-index:3"><svg viewBox="0 0 520 520"><foreignObject x="25" y="270" width="220" height="200"><div class="tx" xmlns="http://www.w3.org/1999/xhtml"><span class="n">02</span><h3>Understanding what's shifting</h3><p>Your emotional responses feel more intense, affecting your relationships and sense of self.</p></div></foreignObject></svg></div>
  <div id="x2" class="pc" style="pointer-events:none;z-index:3"><svg viewBox="0 0 520 520"><foreignObject x="275" y="270" width="220" height="200"><div class="tx" xmlns="http://www.w3.org/1999/xhtml"><span class="n">03</span><h3>The weight of "never enough"</h3><p>Exhausted by expectations that don't reflect who you are or how you want to live.</p></div></foreignObject></svg></div>
  <div class="sf">this is a safe space</div>
  <div class="ht">drag the pieces together</div>
</div>

<script>
(function(){
  const CX=260, CY=260, R=240;
  const rad=d=>d*Math.PI/180;
  const F=v=>v.toFixed(3);
  const edge=a=>[CX+R*Math.cos(rad(a)),CY+R*Math.sin(rad(a))];

  function arc(a1,a2){
    const [x,y]=edge(a2);
    const big=((a2-a1+360)%360)>180?1:0;
    return `A${R},${R} 0 ${big},1 ${F(x)},${F(y)}`;
  }

  /**
   * One seam: radial line at angleDeg, with a bump that points toward (targetX, targetY).
   * Returns {B, A, P, cp1..cp4, ex, ey} in viewBox coords. B/A are inner endpoints, ex/ey is on the circle.
   */
  function seam(angleDeg, targetX, targetY, bumpSize, halfWidth) {
    const t=rad(angleDeg);
    const dx=Math.cos(t), dy=Math.sin(t);
    const hw=halfWidth!=null?halfWidth:36;
    const bump=bumpSize!=null?bumpSize:36;
    const inner=R*0.52;
    const mx=CX+dx*inner, my=CY+dy*inner;

    let px=targetX-mx, py=targetY-my;
    const along=px*dx+py*dy;
    px-=along*dx; py-=along*dy;
    const len=Math.sqrt(px*px+py*py);
    if(len>1e-6){ px/=len; py/=len; }

    const B={x:mx-dx*hw, y:my-dy*hw};
    const A={x:mx+dx*hw, y:my+dy*hw};
    const P={x:mx+px*bump, y:my+py*bump};

    const k=0.65;
    const cp1={x:B.x+px*bump*k, y:B.y+py*bump*k};
    const cp2={x:P.x-dx*hw*0.6, y:P.y-dy*hw*0.6};
    const cp3={x:P.x+dx*hw*0.6, y:P.y+dy*hw*0.6};
    const cp4={x:A.x+px*bump*k, y:A.y+py*bump*k};

    const [ex,ey]=edge(angleDeg);
    return {B,A,P,cp1,cp2,cp3,cp4,ex,ey};
  }

  const P0c={x:260,y:130};
  const P1c={x:150,y:380};
  const P2c={x:370,y:380};

  // Seam A 90° (P0|P1), Seam B 210° (P1|P2 bottom), Seam C 330° (P2|P0). Bump points into the piece that has the socket.
  const SA=seam(90,  P0c.x,P0c.y, 36, 34);
  const SB=seam(210, P1c.x,P1c.y, 50, 42);  // bottom: larger bump and wider so knob/divet are obvious
  const SC=seam(330, P2c.x,P2c.y, 36, 34);

  function fwd(s){
    return `L${F(s.B.x)},${F(s.B.y)} C${F(s.cp1.x)},${F(s.cp1.y)} ${F(s.cp2.x)},${F(s.cp2.y)} ${F(s.P.x)},${F(s.P.y)} C${F(s.cp3.x)},${F(s.cp3.y)} ${F(s.cp4.x)},${F(s.cp4.y)} ${F(s.A.x)},${F(s.A.y)} L${F(s.ex)},${F(s.ey)}`;
  }
  function rev(s){
    return `L${F(s.A.x)},${F(s.A.y)} C${F(s.cp4.x)},${F(s.cp4.y)} ${F(s.cp3.x)},${F(s.cp3.y)} ${F(s.P.x)},${F(s.P.y)} C${F(s.cp2.x)},${F(s.cp2.y)} ${F(s.cp1.x)},${F(s.cp1.y)} ${F(s.B.x)},${F(s.B.y)} L${F(CX)},${F(CY)}`;
  }

  const d0=`M${F(CX)},${F(CY)} ${fwd(SC)} ${arc(330,90)} ${rev(SA)} Z`;
  const d1=`M${F(CX)},${F(CY)} ${fwd(SA)} ${arc(90,210)} ${rev(SB)} Z`;
  const d2=`M${F(CX)},${F(CY)} ${fwd(SB)} ${arc(210,330)} ${rev(SC)} Z`;

  document.getElementById('s0').setAttribute('d',d0);
  document.getElementById('s1').setAttribute('d',d1);
  document.getElementById('s2').setAttribute('d',d2);

  const W=document.getElementById('W');
  const els=[document.getElementById('p0'),document.getElementById('p1'),document.getElementById('p2')];
  const txs=[document.getElementById('x0'),document.getElementById('x1'),document.getElementById('x2')];
  const scatter=[
    {x:-40-Math.random()*60, y:-200-Math.random()*40},
    {x:-260-Math.random()*50, y:60+Math.random()*60},
    {x:180+Math.random()*50, y:60+Math.random()*60}
  ];
  const SNAP=45, NEAR=85;
  const cards=els.map((el,i)=>({ el, tx:txs[i], i, x:scatter[i].x, y:scatter[i].y, locked:false }));

  function apply(c){
    const v=`translate(${Math.round(c.x)}px,${Math.round(c.y)}px)`;
    c.el.style.setProperty('--px', c.x+'px');
    c.el.style.setProperty('--py', c.y+'px');
    c.tx.style.setProperty('--px', c.x+'px');
    c.tx.style.setProperty('--py', c.y+'px');
    if(c.locked){ c.el.classList.add('dn'); c.el.classList.remove('nr'); }
    else{ c.el.classList.remove('dn'); c.el.classList.toggle('nr', Math.hypot(c.x,c.y)<NEAR); }
  }

  function checkComplete(){
    if(!cards.every(c=>c.locked)) return;
    setTimeout(()=> W.classList.add('ad'), 350);
  }

  let drag=null;
  els.forEach((el,i)=>{
    el.addEventListener('pointerdown', function(e){
      const c=cards[i];
      if(c.locked||e.button!==0) return;
      e.preventDefault(); e.stopPropagation();
      const rect=W.getBoundingClientRect();
      drag={ c, id:e.pointerId, dx:e.clientX-rect.left-c.x, dy:e.clientY-rect.top-c.y };
      c.el.classList.add('dr');
      c.el.setPointerCapture(e.pointerId);
      W.querySelector('.ht').style.opacity='0';
    }, {passive:false});
    el.addEventListener('lostpointercapture', e=>{ if(drag&&drag.id===e.pointerId) endDrag(); });
  });

  document.addEventListener('pointermove', e=>{
    if(!drag||drag.id!==e.pointerId) return;
    e.preventDefault();
    const rect=W.getBoundingClientRect();
    drag.c.x=e.clientX-rect.left-drag.dx;
    drag.c.y=e.clientY-rect.top-drag.dy;
    apply(drag.c);
  }, {passive:false});

  document.addEventListener('pointerup', e=>{ if(drag&&drag.id===e.pointerId) endDrag(); });
  document.addEventListener('pointercancel', e=>{ if(drag&&drag.id===e.pointerId) endDrag(); });

  function endDrag(){
    if(!drag) return;
    const c=drag.c;
    const pid=drag.id;
    drag=null;
    c.el.classList.remove('dr');
    try{ c.el.releasePointerCapture(pid); }catch(_){}
    if(Math.hypot(c.x,c.y)<=SNAP){
      c.x=0; c.y=0; c.locked=true;
      apply(c);
      checkComplete();
    } else {
      apply(c);
    }
  }

  cards.forEach(apply);
})();
</script>
</body>
</html>
